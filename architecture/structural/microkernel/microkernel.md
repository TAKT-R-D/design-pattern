# 🧩 Microkernel Architecture

## ✅ このスタイルの概要

**最小限のコア（Microkernel）が土台になり、その上にプラグインや拡張機能を載せるアーキテクチャ。**
OS・IDE・言語処理系など、拡張性重視のシステムでよく使われる。

## ✅ 解決しようとした問題

- コア機能と拡張機能が混ざり合い、変更コストが高い
- カスタム機能やサードパーティ拡張を追加すると、コアがどんどん複雑になる
- 一部機能の障害がシステム全体の安定性に直結してしまう

Microkernel は、

> 「安定していて滅多に変わらないコア」と
> 「追加・変更されやすいプラグイン」を分離する

ことで、構造的な安定性と拡張性を両立しようとする。

## ✅ 基本思想・ルール

### ● Microkernel（コア）

- 最小限の機能のみを提供
  - プラグインのライフサイクル管理
  - 拡張ポイント（Extension Point）の定義
  - 基本的なリソース管理・メッセージング
- 頻繁に変更されないことが前提

### ● Plugin（プラグイン）

- コアが定めたインターフェースを実装
- 具体的な機能やバリエーションを提供
- 動的ロード／アンロードが可能なことも多い

### ● 通信・連携

- プラグイン同士は原則としてコア経由で連携
- 直接依存を増やさないことで結合を制御

## ✅ 得意なアプリケーション

- OS（ファイルシステムドライバ、デバイスドライバなど）
- IDE / エディタ（言語サポート、Lint、リファクタリング機能などのプラグイン）
- 言語処理系（コンパイラのバックエンド、最適化パス）
- ルールエンジンやワークフローエンジン

特徴：

- コアの安定性と拡張性の両立
- プラグイン単位での独立開発・配布

## ✅ 不向きなケース

- 機能追加の頻度が低く、拡張ポイントを設けるコストが見合わない
- シンプルな CRUD アプリケーション
- ドメイン自体が頻繁に大きく変わる領域（コアの設計が追いつかない）

Microkernel を過剰に設計すると：

- 初期設計コストが高すぎる
- 実際には使われない拡張ポイントが乱立する

といった問題も起こりえる。

## ✅ 歴史（系譜・親スタイル）

- OS の世界で、モノリシックカーネルに対するアプローチとして登場
- エンタープライズアプリケーションでは、プラグイン可能なプラットフォームとして採用
- Plugin Architecture という名前でも文脈によっては同義的に扱われることがある

## ✅ 関連スタイル

- **Plugin Architecture**：よりアプリケーション寄りのプラグイン構造
- **Layered Architecture**：コアがインフラストラクチャレイヤの一部として実装されることも
- **Microservices**：機能分割のアプローチとしては別系統だが、拡張性というゴールは共有

## ✅ 代表的なフレームワーク

Microkernel Architecture は OS だけでなく、多くの「拡張性を核とするプロダクト」で採用されている。

- **VSCode / IntelliJ / Eclipse（IDE）**  
  言語サポート・Lint・検索拡張など、すべてプラグインとして提供される。  
  Microkernel + Plugin Architecture の代表例。

- **Linux / BSD（OS カーネル）**  
  デバイスドライバやファイルシステムをモジュールとしてロード可能。

- **ブラウザ（Chrome / Firefox）拡張**  
  コア（レンダリング・セキュリティ）は安定、拡張機能は別レイヤで追加される。

- **ワークフローエンジン（Camunda・JBPM など）**  
  実行コアの上に、プラグイン可能な処理ステップやコンポーネントを追加可能。

## ✅ このスタイルを支えるデザインパターン

Microkernel は明確に複数パターンの組み合わせによって成立しているスタイルである。

- **Strategy**  
  プラグインの振る舞いを“差し替え可能な実装”として扱う。

- **Abstract Factory**  
  プラグインの生成方法（ロード方式・設定）を統一し、実装の切り替えを容易にする。

- **Proxy**  
  プラグインアクセスの制御（監査・キャッシュ・メトリクス）を追加する際に利用。

- **Mediator**  
  プラグイン間の通信をコアに集約し、プラグイン同士の直接依存を避ける。

- **Facade**  
  コアシステムの外観 API として、プラグインや外部システムからの利用を統一する役割を果たす。

## ✅ まとめ

Microkernel Architecture は、

- 長期運用されるプラットフォーム
- サードパーティ拡張やバリエーションを前提としたシステム

において、**「変わらない部分」と「変わる部分」を構造的に分離するための強力なスタイル** である。

ただし、小規模なアプリに無理に適用するとオーバーエンジニアリングになりやすいため、
適用範囲と寿命を見極めて採用することが重要である。
