# Batch Pipeline（バッチパイプライン）

## 1. 一言でいうと

**一定期間分のデータをまとめて処理する「バッチジョブ」を、複数ステージのパイプラインとして構成するスタイル。**

---

## 2. 解決しようとした問題

- 1 つのバッチジョブが巨大化し、何をどの順番でやっているか分からない
- 一部ステップだけ再実行したい／並列化したいのに難しい
- 障害時のリカバリポイントが分かりにくい

Batch Pipeline は、

> 「バッチ処理をステージごとに分解し、パイプラインとして設計する」

ことで、運用・保守・スケーリングを行いやすくします。

---

## 3. 基本思想・ルール

典型的なバッチパイプラインのステージ例：

1. 抽出（Extract）
2. 変換（Transform）
3. ロード（Load）
4. 集計・書き出し

各ステージは：

- 入力データセットを受け取り
- 自身の責務を果たし
- 次のステージに渡す

という構造を取ります。

実装形態：

- 1 つのプロセス内で順次実行
- 複数ジョブに分けてキュー・スケジューラで連結
- ワークフローエンジン（Airflow など）で DAG として定義

---

## 3.1 概念図（Conceptual Diagram）

```mermaid
flowchart LR
    SRC[Source Data]
    EX[Extract]
    TR[Transform]
    LD[Load]
    AGG[Aggregate / Report]

    SRC --> EX --> TR --> LD --> AGG
```

---

## 4. 得意なアプリケーション

- 日次／時間毎のバッチ処理
- ETL ジョブ（データウェアハウスへのロード）
- ログ集計・レポート生成
- バルクインポート／エクスポート処理

特徴：

- ステージ単位でのモニタリング・再実行がしやすい
- ステージごとのスケール戦略を立てやすい

---

## 5. 不向きなケース

- ほぼリアルタイムの応答が必要な処理
- イベント駆動で常時動作すべきストリーミング処理

そのようなケースでは、Streaming Pipeline や EDA の方が向きます。

---

## 6. 歴史（系譜・親スタイル）

- 古くから存在するバッチ処理の実務知見を、パイプラインという形で整理したもの
- Data Warehouse / DWH 文脈の ETL パターンと密接
- 近年はワークフローオーケストレーションツールと組み合わさることが多い

---

## 7. 関連スタイル

- **Pipe & Filter**：1 プロセス内のシンプルなパイプラインの原型
- **Streaming Pipeline**：リアルタイム処理への発展
- **Data Architecture（Lambda / Kappa）**：バッチレイヤーとしての位置づけ

---

---

## 8. Framework Examples（代表的なフレームワーク・基盤）

Batch Pipeline はバッチワークフローを支える基盤として広く利用されています。

- **Apache Airflow / Dagster / Argo Workflows**  
  DAG（有向非巡回グラフ）でパイプラインを組み、ステージごとの再実行や依存管理を実現。

- **AWS Glue / Google Cloud Dataflow（バッチモード）**  
  ETL / データ変換処理を段階的パイプラインとして構築できる。

- **Spark（Batch Processing）**  
  RDD / DataFrame によるステージ処理がパイプラインに相当する。

- **Airbyte / Fivetran（ELT ツール）**  
  Extract → Load → Transform のステップを明確に構造化。

---

## 9. Supported Design Patterns（このスタイルを支えるデザインパターン）

Batch Pipeline の内部では、段階的処理と再利用を支えるために次のパターンが使われます。

- **Chain of Responsibility**  
  ステージを直列につなぎ、順番に処理していく。

- **Template Method**  
  ジョブの前処理・後処理、共通フローを統一化する。

- **Iterator**  
  大規模データを逐次的に処理する際の補助として。

- **Strategy**  
  ステージごとに異なるアルゴリズムを差し替え可能にする。

---

## 8. まとめ

Batch Pipeline は、

- バッチ処理の複雑さをステージ分割で制御し
- 運用面（監視・再実行・リカバリ）も意識した構造スタイルです。

バッチが「1 つの巨大なブラックボックス」になりつつあるなら、
**パイプラインとしての再設計** を検討するサインかもしれません。
