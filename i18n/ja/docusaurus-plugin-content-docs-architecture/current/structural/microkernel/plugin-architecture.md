# 🧩 Plugin Architecture

## ✅ このスタイルの概要

アプリケーションが **明示的な拡張ポイント（Extension Point）を提供し、  
そこにプラグインを差し込むことで機能追加・カスタマイズを可能にする構造スタイル。**

## ✅ 解決しようとした問題

- 顧客やプロジェクトごとに必要な機能が異なる
- 追加機能のたびに本体をフォーク・改造するのはコストが高い
- サードパーティによるエコシステム（プラグインマーケット）を構築したい

Plugin Architecture は、

> 「本体はコア機能を提供し、拡張はプラグインとして後付けする」

ことで、変更容易性とエコシステム構築を支える。

## ✅ 基本思想・ルール

### ● Extension Point（拡張ポイント）

- コアが「ここにプラグインを差し込める」というスロットを定義
- インターフェースやイベント、設定ファイルによって表現される

### ● Plugin（プラグイン）

- 拡張ポイントの契約（インターフェース）を実装
- 機能を追加／置き換え／フィルタリングする
- 設定やマーケットプレイス経由で有効化・無効化されることが多い

### ● 実装パターン

- クラスパススキャン / リフレクション
- DI コンテナによる登録
- 設定ファイル・マニフェストによる宣言

## ✅ 得意なアプリケーション

- エディタ / IDE（Lint, Formatter, Language Support 等の拡張）
- CI/CD ツール（各種プラグインで対応サービスを追加）
- CMS / EC プラットフォーム（テーマ・アドオン）
- SaaS プラットフォーム（Webhook / App 機構を提供するもの）

## ❌ 不向きなケース

- 機能のバリエーションがほとんどない単一用途のアプリ
- セキュリティ要件が極端に厳しく、外部コード実行を避けたいケース
- プラグイン境界が曖昧で、結局コアと強く結合してしまうような設計

といった問題も起こりえる。

## ✅ 歴史（系譜・親スタイル）

- Microkernel 的な発想を、よりアプリケーションレベルで具体化したスタイル
- Eclipse / VSCode / IntelliJ などの IDE をはじめ、多くのツールで普及
- Web プラットフォーム（ブラウザ拡張・SaaS のアプリ連携）にも応用されている

## ✅ 関連スタイル

- **[Microkernel Architecture](./microkernel-architecture.md)**：コアとプラグインの分離という観点でほぼ同系統
- **[Event-Driven Architecture](../../integration/event-driven.md)**：イベント購読型の拡張ポイントとして組み合わせやすい
- **[Layered Architecture](../layered/index.md)**：特定レイヤーに対するプラグイン（例：認証方式の差し替え）としても利用可能

## ✅ 代表的なフレームワーク

Plugin Architecture はアプリケーションレベルでの Microkernel 的構造として広く普及している。

- **VSCode / IntelliJ**  
  言語サーバ・フォーマッタ・デバッガなど、すべてプラグイン経由で追加。

- **WordPress / Shopify / Joomla**  
  CMS / EC の機能拡張としてテーマ・アドオン・アプリをプラグインとして追加。

- **CI/CD ツール（Jenkins・GitHub Actions）**  
  ビルド・デプロイ・通知など、各処理ステップをプラグインとして分離。

- **モダン SaaS の外部連携（Webhook / App）**  
  外部サービスが“アプリとして拡張ポイントに差し込まれる”構造。

## ✅ このスタイルを支えるデザインパターン

Plugin Architecture は、Microkernel と比べるとアプリケーション寄りだが、用いられるパターンの本質は同じである。

- **Strategy**  
  プラグインの実装差し替えを自然に表現するための中心的パターン。

- **Abstract Factory**  
  プラグインのロード方法（設定・メタデータ）を統一するために利用。

- **Proxy**  
  プラグインの呼び出しに対して、ログ・認可・キャッシュなどの制御を追加する。

- **Mediator**  
  プラグイン間やプラグイン ⇔ コアの調整を一箇所に集約する。

- **Decorator**  
  プラグインの機能を追加でラップして拡張する場面が多い。

## ✅ まとめ

Plugin Architecture は、

- ユーザーごとの多様なニーズへの対応
- サードパーティによるエコシステムの構築

を実現するために、**アプリケーションに「拡張ポイント」を設け、機能を後付けで追加・カスタマイズ可能にするスタイル** である。

Microkernel Architecture のアプリケーション版として広く普及しており、IDE や CMS、SaaS などで採用されている。  
ただし、拡張ポイントの設計やセキュリティ管理が複雑になりがちなため、拡張性の必要性とコストのバランスを考慮して採用する必要がある。

